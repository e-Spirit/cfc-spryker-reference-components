{% extends model('component') %}

{% define config = {
    name: 'fs-n-teaser-item-content',
    tag: 'article'
} %}

{% define data = {
    fsBlockData: []
} %}

{% set hasLink = false %}
{% set hasTargetBlank = false %}

{% block body %}

{% if data.fsBlockData.data.st_link is not null %}
    {% if data.fsBlockData.data.st_link.data.lt_link.template == "external_link" %}
        {% set url = data.fsBlockData.data.st_link.data.lt_link.data.lt_linkUrl %}
        {% set hasLink = true %}
        {% set hasTargetBlank = true %}
    {% elseif data.fsBlockData.data.st_link.data.lt_link.template == "product_link" %}
        {% set product = firstSpiritProductData(data.fsBlockData.data.st_link.data.lt_link.data.lt_product.value[0].identifier) %}
        {% if product is not null %}
            {% set url = product.url %}
            {% set hasLink = true %}
        {% endif %}
    {% elseif data.fsBlockData.data.st_link.data.lt_link.template == "category_link" %}
        {% set category = firstSpiritCategoryData(data.fsBlockData.data.st_link.data.lt_link.data.lt_category.value[0].identifier) %}
        {% if category is not null %}
            {% set url = category.url %}
            {% set hasLink = true %}
        {% endif %}
    {% else %}
        {% set pageId = data.fsBlockData.data.st_link.data.lt_link.data.lt_pageref.referenceId %}
        {% set previewId = data.fsBlockData.previewId %}
        {% set url = firstSpiritContentLink(pageId, previewId).url %}
        {% set hasLink = true %}
    {% endif %}
{% endif %}

<div class="fs-n-teaser-image">
    {% if data.fsBlockData.data.st_picture is defined and data.fsBlockData.data.st_picture is not empty %}
        {% if hasLink and hasTargetBlank %}
            <a href="{{url}}" target="_blank">
        {% elseif hasLink %}
            <a href="{{url}}">
        {% else %}
            <a href="#">
        {% endif %}
        <picture
            data-preview-id="{{ data.fsBlockData.data.st_picture.previewId }}"
            data-tpp-context-image-resolution="TEASER_IMAGE">
                {% for resolution in data.fsBlockData.data.st_picture.resolutions %}
                    <source srcset="{{resolution.url}}" media="(max-width: {{resolution.width}}px)" />
                {% endfor %}


                <img src="{{ data.fsBlockData.data.st_picture.resolutions.ORIGINAL.url }}"
                    alt="{% if data.fsBlockData.data.st_picture.description is not null %}{{data.fsBlockData.data.st_picture.description}}{% endif %}">
        </picture>
        </a>
    {% endif %}
</div>
<div class="fs-n-teaser-content">
    {% set contentHeadline = data.fsBlockData.data.st_headline %}
    {% if contentHeadline is defined and contentHeadline is not empty %}
        <h3>{{ contentHeadline | raw }}</h3>
    {% endif %}
    {% set contentDescription = data.fsBlockData.data.st_subline %}
    {% if contentDescription is defined and contentDescription is not empty %}
        <h4>{{ contentDescription | raw }}</h4>
    {% endif %}
    {% set contentText = data.fsBlockData.data.st_text %}
    {% if contentText is defined and contentText is not empty %}
        <p>{{ contentText | raw }}</p>
    {% endif %}
    {% if data.fsBlockData.data.st_link is not null %}
        {% set linkText = data.fsBlockData.data.st_link.data.lt_text %}
            {% if hasLink and hasTargetBlank %}
                <a href="{{url}}" target="_blank" class="fs-btn-link">
            {% elseif hasLink %}
                <a href="{{url}}" class="fs-btn-link">
            {% else %}
                <a href="#" class="fs-btn-link">
            {% endif %}
            {% if linkText is defined and linkText is not empty %}
                {{ linkText | raw }}
            {% else %}
                Link
            {% endif %}
        </a>
    {% endif %}
</div>
{% endblock %}
